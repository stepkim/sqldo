(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5d2bd2ee"],{1885:function(t,e,r){},"2f63":function(t,e,r){"use strict";r("e896")},5893:function(t,e,r){"use strict";r("ce2e")},ce2e:function(t,e,r){},dcd5:function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"c",(function(){return c})),r.d(e,"b",(function(){return i}));var a=r("3c11"),n=r("3e4a"),o={basic:"".concat(a["a"].url,"/manage/tpl")};function s(){return Object(n["a"])({method:"get",url:o.basic})}function c(t){return Object(n["a"])({method:"put",params:{source:t},url:o.basic})}function i(t){return Object(n["a"])({method:"post",data:t,url:o.basic})}},dd1e:function(t,e,r){"use strict";r("1885")},e54e:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("Card",{attrs:{"dis-hover":""}},[r("Row",[r("Col",{attrs:{span:"5"}},[r("h2",[t._v("工单编号:"+t._s(this.order.work_id))])]),r("Col",{attrs:{span:"5",offset:"14"}},[r("ButtonGroup",[r("Button",{attrs:{type:"default"},nativeOn:{click:function(e){return t.$router.go(-1)}}},[t._v("返回")]),1===t.order.status||4===t.order.status?r("Button",{attrs:{type:"default"},nativeOn:{click:function(e){return t.open_form()}}},[t._v("\n                        查看回滚语句\n                    ")]):t._e(),0===t.order.status?r("Button",{attrs:{type:"default"},nativeOn:{click:function(e){return t.open_form()}}},[t._v("重新提交\n                    ")]):t._e(),r("Poptip",{attrs:{confirm:"",title:"确定要撤销工单吗？",transfer:""},on:{"on-ok":function(e){return t.delOrder(t.order.work_id)}}},[2!==t.order.status||JSON.parse(t.$route.query.isAdmin)?t._e():r("Button",{attrs:{type:"default"}},[t._v("工单撤销\n                        ")])],1)],1)],1)],1),r("br"),r("basic")],1),r("br"),r("Card",{attrs:{"dis-hover":""}},[r("p",{attrs:{slot:"title"},slot:"title"},[t._v("流程步骤")]),r("Steps",{attrs:{current:t.order.current_step}},t._l(t.order_step,(function(t){return r("Step",{key:t.title,attrs:{title:t.desc,content:"相关人员:"+t.auditor}})})),1)],1),r("br"),r("Card",[r("p",{attrs:{slot:"title"},slot:"title"},[t._v("流程记录")]),r("StepDetail")],1),r("br"),r("Card",[r("p",{attrs:{slot:"title"},slot:"title"},[t._v("SQL审核")]),r("collapse"),r("br"),t.order.assigned===t.user&&JSON.parse(t.$route.query.isAdmin)?[r("Testing")]:t._e()],2),r("BackTop",{attrs:{height:100,bottom:200}},[r("div",{staticClass:"top"},[t._v("返回顶端")])]),r("post-form",{model:{value:t.is_open,callback:function(e){t.is_open=e},expression:"is_open"}})],1)},n=[],o=(r("2397"),r("d225")),s=r("b0b4"),c=r("4e2b"),i=r("308d"),l=r("6bb5"),u=r("9ab4"),d=r("74e3"),f=r("60a3"),p=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("Collapse",{attrs:{simple:""},model:{value:t.collapse,callback:function(e){t.collapse=e},expression:"collapse"}},[r("Panel",{attrs:{name:"sql"}},[t._v("\n        提交的SQL语句\n        "),r("div",{attrs:{slot:"content"},slot:"content"},[r("RadioGroup",{on:{"on-change":t.fetch_post_sql},model:{value:t.switch_args.is_more,callback:function(e){t.$set(t.switch_args,"is_more",e)},expression:"switch_args.is_more"}},[r("Radio",{attrs:{label:"10"}},[t._v("\n                    仅显示10条以内的SQL\n                ")]),r("Radio",{attrs:{label:"0"}},[t._v("\n                    显示全部SQL\n                ")])],1),r("br"),r("br"),r("editor",{attrs:{is_read:!0},on:{init:t.editorInit},model:{value:t.sqls,callback:function(e){t.sqls=e},expression:"sqls"}})],1)]),1===t.order.status||4===t.order.status?r("Panel",{attrs:{name:"results"}},[t._v("\n        执行结果\n        "),r("div",{attrs:{slot:"content"},slot:"content"},[r("Row",[r("Col",{attrs:{span:"24"}},[r("Table",{staticClass:"tabletop",staticStyle:{background:"#5cadff"},attrs:{border:"",columns:t.columns,data:t.results,size:"large"}}),r("br"),r("Page",{ref:"page",attrs:{total:t.page_number,"show-elevator":"","page-size":10},on:{"on-change":t.current_page}})],1)],1)],1)]):t._e()],1)},b=[],v=r("a897");function _(t){var e=h();return function(){var r,a=Object(l["a"])(t);if(e){var n=Object(l["a"])(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return Object(i["a"])(this,r)}}function h(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var y=function(t){Object(c["a"])(r,t);var e=_(r);function r(){return Object(o["a"])(this,r),e.apply(this,arguments)}return Object(s["a"])(r,[{key:"mounted",value:function(){this.current_page()}}]),r}(Object(f["b"])(d["a"]));y=Object(u["b"])([Object(f["a"])({components:{Editor:v["a"]}})],y);var O=y,m=O,j=r("2877"),k=Object(j["a"])(m,p,b,!1,null,"b857e65c",null),g=k.exports,R=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("Row",{attrs:{type:"flex",justify:"center",align:"top"}},[r("Col",{staticClass:"cell",attrs:{span:"6"}},[r("div",{staticClass:"title"},[t._v("环境: "+t._s(t.order.idc))]),r("br"),r("div",{staticClass:"title"},[t._v("数据源: "+t._s(t.order.source))]),r("br"),r("div",{staticClass:"title"},[t._v("数据库: "+t._s(t.order.data_base))]),r("br"),r("div",{staticClass:"title"},[t._v("数据表: "+t._s(t.order.table))]),r("br"),r("div",{staticClass:"title"},[t._v("是否备份: "+t._s(0===t.order.backup?"否":"是"))])]),r("Col",{staticClass:"cell",attrs:{span:"6"}},[r("div",{staticClass:"title"},[t._v("提交人: "+t._s(t.order.username))]),r("br"),r("div",{staticClass:"title"},[t._v("提交时间: "+t._s(t.order.date))]),r("br"),r("div",{staticClass:"title"},[t._v("工单说明: "+t._s(t.order.text))]),r("br"),r("div",{staticClass:"title"},[t._v("定时执行: "+t._s(t.order.delay))])]),r("Col",{attrs:{span:"5"}},[r("div",{staticStyle:{"text-align":"center"}},[r("p",[t._v("当前状态")]),2===t.order.status?r("h1",{staticStyle:{color:"#2b85e4"}},[t._v("审核中")]):0===t.order.status?r("h1",{staticStyle:{color:"#c1273e"}},[t._v("驳回")]):1===t.order.status?r("h1",{staticStyle:{color:"#35ba71"}},[t._v("已执行")]):4===t.order.status?r("h1",{staticStyle:{color:"#e42b47"}},[t._v("执行失败")]):5===t.order.status?r("h1",{staticStyle:{color:"#2b85e4"}},[t._v("待执行")]):2===t.order.status?r("h1",{staticStyle:{color:"#ee881a"}},[t._v("执行中")]):t._e()])]),r("Col",{attrs:{span:"7"}},[r("div",{staticStyle:{"text-align":"center"}},[r("p",[t._v("SQL类型")]),0===t.order.type?r("h3",[t._v("DDL")]):r("h3",[t._v("DML")])])])],1)},C=[];function x(t){var e=w();return function(){var r,a=Object(l["a"])(t);if(e){var n=Object(l["a"])(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return Object(i["a"])(this,r)}}function w(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var S=function(t){Object(c["a"])(r,t);var e=x(r);function r(){return Object(o["a"])(this,r),e.apply(this,arguments)}return r}(f["d"]);S=Object(u["b"])([Object(f["a"])({components:{},mixins:[d["a"]]})],S);var q=S,B=q,$=(r("2f63"),Object(j["a"])(B,R,C,!1,null,"5ae717c9",null)),P=$.exports,T=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("Modal",{attrs:{"ok-text":"提交工单",width:"800"},on:{"on-ok":t.referOrder,"on-cancel":t.cancel},model:{value:t.is_open,callback:function(e){t.is_open=e},expression:"is_open"}},[r("Divider",{attrs:{plain:"",orientation:"left"}},[t._v("基本信息")]),r("Row",{attrs:{type:"flex",justify:"end",align:"bottom"}},[r("Col",{staticClass:"cell",attrs:{span:"12"}},[r("div",{staticClass:"title"},[t._v("用户名: "+t._s(t.order.username))]),r("br"),r("div",{staticClass:"title"},[t._v("环境: "+t._s(t.order.idc))]),r("br"),r("div",{staticClass:"title"},[t._v("定时执行: "+t._s(t.order.delay))]),r("br")]),r("Col",{staticClass:"cell",attrs:{span:"12"}},[r("div",{staticClass:"title"},[t._v("连接名: "+t._s(t.order.source))]),r("br"),r("div",{staticClass:"title"},[t._v("数据库库名: "+t._s(t.order.data_base))]),r("br")])],1),0===this.order.status?[r("Divider",{attrs:{plain:"",orientation:"left"}},[t._v("重新提交的语句")]),r("Input",{attrs:{type:"textarea",rows:5},model:{value:t.sqls,callback:function(e){t.sqls=e},expression:"sqls"}})]:t._e(),1===this.order.status||4===this.order.status?[r("Divider",{attrs:{plain:"",orientation:"left"}},[t._v("回滚语句")]),r("Table",{attrs:{columns:t.roll_column,data:t.roll_data,height:"200","show-header":!1,size:"small","no-data-text":"该工单没有生成回滚语句! 请检查提交工单时是否已选择备份/数据库设置是否正确。<br/>详细情况请访问:https://guide.yearning.io/attention.html"}}),r("br"),r("Page",{attrs:{total:t.page_number,"show-elevator":"","page-size":5,current:t.current},on:{"on-change":t.rollback,"update:current":function(e){t.current=e}}})]:t._e(),r("Divider",{attrs:{plain:"",orientation:"left"}},[t._v("提交信息")]),r("Form",[r("FormItem",{attrs:{label:"工单提交说明:"}},[r("Input",{staticStyle:{width:"600px"},attrs:{placeholder:"最多不超过20个字",type:"textarea",rows:3},model:{value:t.order.text,callback:function(e){t.$set(t.order,"text",e)},expression:"order.text"}})],1),r("FormItem",{attrs:{label:"是否备份"}},[r("RadioGroup",{model:{value:t.order.backup,callback:function(e){t.$set(t.order,"backup",e)},expression:"order.backup"}},[r("Radio",{attrs:{label:1}},[t._v("是")]),r("Radio",{attrs:{label:0}},[t._v("否")])],1)],1)],1)],2)],1)},D=[],L=r("edd3");function E(t){var e=I();return function(){var r,a=Object(l["a"])(t);if(e){var n=Object(l["a"])(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return Object(i["a"])(this,r)}}function I(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Q=function(t){Object(c["a"])(r,t);var e=E(r);function r(){var t;return Object(o["a"])(this,r),t=e.apply(this,arguments),t.roll_data=[],t.roll_column=[{title:"当前检查的sql",key:"sql",tooltip:!0}],t}return Object(s["a"])(r,[{key:"get_visible",value:function(t){t&&1===this.order.backup&&this.rollback(),this.is_open=t}},{key:"cancel",value:function(){this.is_open=!1,this.current=1,this.$emit("input",!1)}},{key:"referOrder",value:function(){var t=this,e=Object.assign({},this.order);Object(L["b"])("roll_order",{data:e,sqls:this.sqls,tp:this.order.status}).then((function(){t.$router.go(-1)}))}},{key:"rollback",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;Object(L["a"])("roll",{work_id:this.order.work_id,page:e}).then((function(e){t.roll_data=e.data.payload.sql,t.page_number=e.data.payload.count}))}}]),r}(Object(f["b"])(d["a"]));Object(u["b"])([Object(f["c"])({type:Boolean,required:!0,default:!1})],Q.prototype,"value",void 0),Object(u["b"])([Object(f["e"])("value")],Q.prototype,"get_visible",null),Q=Object(u["b"])([Object(f["a"])({components:{}})],Q);var z=Q,F=z,J=(r("dd1e"),Object(j["a"])(F,T,D,!1,null,"4c3b8db9",null)),G=J.exports,A=r("119b"),M=r("476e"),N=r("a334"),H=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("Table",{attrs:{columns:t.col,data:t.table_data,"max-height":"200",border:""},scopedSlots:t._u([{key:"action",fn:function(e){var a=e.row;return["已提交"===a.action?r("Tag",{attrs:{color:"blue"}},[t._v(t._s(a.action))]):"驳回"===a.action?r("Tag",{attrs:{color:"error"}},[t._v(t._s(a.action))]):"审核通过并执行"===a.action?r("Tag",{attrs:{color:"success"}},[t._v(t._s(a.action))]):r("Tag",{attrs:{color:"primary"}},[t._v(t._s(a.action))])]}}])})],1)},K=[];function U(t){var e=V();return function(){var r,a=Object(l["a"])(t);if(e){var n=Object(l["a"])(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return Object(i["a"])(this,r)}}function V(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var W=function(t){Object(c["a"])(r,t);var e=U(r);function r(){var t;return Object(o["a"])(this,r),t=e.apply(this,arguments),t.col=[{title:"相关人",key:"username"},{title:"操作",key:"action",slot:"action"},{title:"操作时间",key:"time"},{title:"驳回信息",key:"rejected"}],t}return Object(s["a"])(r,[{key:"mounted",value:function(){var t=this;Object(L["a"])("steps",{work_id:this.order.work_id}).then((function(e){return t.table_data=e.data.payload}))}}]),r}(Object(f["b"])(d["a"]));W=Object(u["b"])([Object(f["a"])({components:{}})],W);var X=W,Y=X,Z=Object(j["a"])(Y,H,K,!1,null,"3fee42fe",null),tt=Z.exports,et=r("dcd5");function rt(t){var e=at();return function(){var r,a=Object(l["a"])(t);if(e){var n=Object(l["a"])(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return Object(i["a"])(this,r)}}function at(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var nt=function(t){Object(c["a"])(r,t);var e=rt(r);function r(){var t;return Object(o["a"])(this,r),t=e.apply(this,arguments),t.user=sessionStorage.getItem("user"),t}return Object(s["a"])(r,[{key:"order_step",get:function(){return N["a"].order_step}},{key:"created",value:function(){Object(et["c"])(this.order.idc).then((function(t){N["a"].fetch_order_step(t.data.payload.steps)}))}},{key:"mounted",value:function(){this.fetch_post_sql()}}]),r}(Object(f["b"])(d["a"]));nt=Object(u["b"])([Object(f["a"])({components:{collapse:g,basic:P,postForm:G,Testing:A["a"],reject:M["a"],StepDetail:tt}})],nt);var ot=nt,st=ot,ct=(r("5893"),Object(j["a"])(st,a,n,!1,null,null,null));e["default"]=ct.exports},e896:function(t,e,r){}}]);